/* The GIMP -- an image manipulation program
 * Copyright (C) 1995-2003 Spencer Kimball and Peter Mattis
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
 */

/* NOTE: This file is autogenerated by pdbgen.pl. */

#include "config.h"


#include <glib-object.h>

#include "libgimpbase/gimpbase.h"

#include "pdb-types.h"
#include "procedural_db.h"
#include "core/gimpparamspecs.h"

#include "core/gimp.h"
#include "plug-in/plug-in-data.h"
#include "procedural-db-query.h"

static ProcRecord procedural_db_temp_name_proc;
static ProcRecord procedural_db_dump_proc;
static ProcRecord procedural_db_query_proc;
static ProcRecord procedural_db_proc_info_proc;
static ProcRecord procedural_db_proc_arg_proc;
static ProcRecord procedural_db_proc_val_proc;
static ProcRecord procedural_db_get_data_proc;
static ProcRecord procedural_db_get_data_size_proc;
static ProcRecord procedural_db_set_data_proc;

void
register_procedural_db_procs (Gimp *gimp)
{
  /*
   * procedural_db_temp_name
   */
  procedural_db_init_proc (&procedural_db_temp_name_proc, 0, 1);
  procedural_db_add_return_value (&procedural_db_temp_name_proc,
                                  GIMP_PDB_STRING,
                                  gimp_param_spec_string ("temp-name",
                                                          "temp name",
                                                          "A unique temporary name for a temporary PDB entry",
                                                          FALSE, FALSE,
                                                          NULL,
                                                          GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, &procedural_db_temp_name_proc);

  /*
   * procedural_db_dump
   */
  procedural_db_init_proc (&procedural_db_dump_proc, 1, 0);
  procedural_db_add_argument (&procedural_db_dump_proc,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("filename",
                                                      "filename",
                                                      "The dump filename",
                                                      TRUE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, &procedural_db_dump_proc);

  /*
   * procedural_db_query
   */
  procedural_db_init_proc (&procedural_db_query_proc, 7, 2);
  procedural_db_add_argument (&procedural_db_query_proc,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("name",
                                                      "name",
                                                      "The regex for procedure name",
                                                      TRUE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_argument (&procedural_db_query_proc,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("blurb",
                                                      "blurb",
                                                      "The regex for procedure blurb",
                                                      TRUE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_argument (&procedural_db_query_proc,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("help",
                                                      "help",
                                                      "The regex for procedure help",
                                                      TRUE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_argument (&procedural_db_query_proc,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("author",
                                                      "author",
                                                      "The regex for procedure author",
                                                      TRUE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_argument (&procedural_db_query_proc,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("copyright",
                                                      "copyright",
                                                      "The regex for procedure copyright",
                                                      TRUE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_argument (&procedural_db_query_proc,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("date",
                                                      "date",
                                                      "The regex for procedure date",
                                                      TRUE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_argument (&procedural_db_query_proc,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("proc-type",
                                                      "proc type",
                                                      "The regex for procedure type: { 'Internal GIMP procedure', 'GIMP Plug-In', 'GIMP Extension', 'Temporary Procedure' }",
                                                      TRUE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (&procedural_db_query_proc,
                                  GIMP_PDB_INT32,
                                  g_param_spec_int ("num-matches",
                                                    "num matches",
                                                    "The number of matching procedures",
                                                    0, G_MAXINT32, 0,
                                                    GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (&procedural_db_query_proc,
                                  GIMP_PDB_STRINGARRAY,
                                  g_param_spec_pointer ("procedure-names",
                                                        "procedure names",
                                                        "The list of procedure names",
                                                        GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, &procedural_db_query_proc);

  /*
   * procedural_db_proc_info
   */
  procedural_db_init_proc (&procedural_db_proc_info_proc, 1, 8);
  procedural_db_add_argument (&procedural_db_proc_info_proc,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("procedure",
                                                      "procedure",
                                                      "The procedure name",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (&procedural_db_proc_info_proc,
                                  GIMP_PDB_STRING,
                                  gimp_param_spec_string ("blurb",
                                                          "blurb",
                                                          "A short blurb",
                                                          FALSE, FALSE,
                                                          NULL,
                                                          GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (&procedural_db_proc_info_proc,
                                  GIMP_PDB_STRING,
                                  gimp_param_spec_string ("help",
                                                          "help",
                                                          "Detailed procedure help",
                                                          FALSE, FALSE,
                                                          NULL,
                                                          GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (&procedural_db_proc_info_proc,
                                  GIMP_PDB_STRING,
                                  gimp_param_spec_string ("author",
                                                          "author",
                                                          "Author(s) of the procedure",
                                                          FALSE, FALSE,
                                                          NULL,
                                                          GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (&procedural_db_proc_info_proc,
                                  GIMP_PDB_STRING,
                                  gimp_param_spec_string ("copyright",
                                                          "copyright",
                                                          "The copyright",
                                                          FALSE, FALSE,
                                                          NULL,
                                                          GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (&procedural_db_proc_info_proc,
                                  GIMP_PDB_STRING,
                                  gimp_param_spec_string ("date",
                                                          "date",
                                                          "Copyright date",
                                                          FALSE, FALSE,
                                                          NULL,
                                                          GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (&procedural_db_proc_info_proc,
                                  GIMP_PDB_INT32,
                                  g_param_spec_enum ("proc-type",
                                                     "proc type",
                                                     "The procedure type: { GIMP_INTERNAL (0), GIMP_PLUGIN (1), GIMP_EXTENSION (2), GIMP_TEMPORARY (3) }",
                                                     GIMP_TYPE_PDB_PROC_TYPE,
                                                     GIMP_INTERNAL,
                                                     GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (&procedural_db_proc_info_proc,
                                  GIMP_PDB_INT32,
                                  g_param_spec_int ("num-args",
                                                    "num args",
                                                    "The number of input arguments",
                                                    G_MININT32, G_MAXINT32, 0,
                                                    GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (&procedural_db_proc_info_proc,
                                  GIMP_PDB_INT32,
                                  g_param_spec_int ("num-values",
                                                    "num values",
                                                    "The number of return values",
                                                    G_MININT32, G_MAXINT32, 0,
                                                    GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, &procedural_db_proc_info_proc);

  /*
   * procedural_db_proc_arg
   */
  procedural_db_init_proc (&procedural_db_proc_arg_proc, 2, 3);
  procedural_db_add_argument (&procedural_db_proc_arg_proc,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("procedure",
                                                      "procedure",
                                                      "The procedure name",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_argument (&procedural_db_proc_arg_proc,
                              GIMP_PDB_INT32,
                              g_param_spec_int ("arg-num",
                                                "arg num",
                                                "The argument number",
                                                G_MININT32, G_MAXINT32, 0,
                                                GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (&procedural_db_proc_arg_proc,
                                  GIMP_PDB_INT32,
                                  g_param_spec_enum ("arg-type",
                                                     "arg type",
                                                     "The type of argument: { GIMP_PDB_INT32 (0), GIMP_PDB_INT16 (1), GIMP_PDB_INT8 (2), GIMP_PDB_FLOAT (3), GIMP_PDB_STRING (4), GIMP_PDB_INT32ARRAY (5), GIMP_PDB_INT16ARRAY (6), GIMP_PDB_INT8ARRAY (7), GIMP_PDB_FLOATARRAY (8), GIMP_PDB_STRINGARRAY (9), GIMP_PDB_COLOR (10), GIMP_PDB_REGION (11), GIMP_PDB_DISPLAY (12), GIMP_PDB_IMAGE (13), GIMP_PDB_LAYER (14), GIMP_PDB_CHANNEL (15), GIMP_PDB_DRAWABLE (16), GIMP_PDB_SELECTION (17), GIMP_PDB_BOUNDARY (18), GIMP_PDB_VECTORS (19), GIMP_PDB_PARASITE (20), GIMP_PDB_STATUS (21), GIMP_PDB_PATH (GIMP_PDB_VECTORS) }",
                                                     GIMP_TYPE_PDB_ARG_TYPE,
                                                     GIMP_PDB_INT32,
                                                     GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (&procedural_db_proc_arg_proc,
                                  GIMP_PDB_STRING,
                                  gimp_param_spec_string ("arg-name",
                                                          "arg name",
                                                          "The name of the argument",
                                                          FALSE, FALSE,
                                                          NULL,
                                                          GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (&procedural_db_proc_arg_proc,
                                  GIMP_PDB_STRING,
                                  gimp_param_spec_string ("arg-desc",
                                                          "arg desc",
                                                          "A description of the argument",
                                                          FALSE, FALSE,
                                                          NULL,
                                                          GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, &procedural_db_proc_arg_proc);

  /*
   * procedural_db_proc_val
   */
  procedural_db_init_proc (&procedural_db_proc_val_proc, 2, 3);
  procedural_db_add_argument (&procedural_db_proc_val_proc,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("procedure",
                                                      "procedure",
                                                      "The procedure name",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_argument (&procedural_db_proc_val_proc,
                              GIMP_PDB_INT32,
                              g_param_spec_int ("val-num",
                                                "val num",
                                                "The return value number",
                                                G_MININT32, G_MAXINT32, 0,
                                                GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (&procedural_db_proc_val_proc,
                                  GIMP_PDB_INT32,
                                  g_param_spec_enum ("val-type",
                                                     "val type",
                                                     "The type of return value: { GIMP_PDB_INT32 (0), GIMP_PDB_INT16 (1), GIMP_PDB_INT8 (2), GIMP_PDB_FLOAT (3), GIMP_PDB_STRING (4), GIMP_PDB_INT32ARRAY (5), GIMP_PDB_INT16ARRAY (6), GIMP_PDB_INT8ARRAY (7), GIMP_PDB_FLOATARRAY (8), GIMP_PDB_STRINGARRAY (9), GIMP_PDB_COLOR (10), GIMP_PDB_REGION (11), GIMP_PDB_DISPLAY (12), GIMP_PDB_IMAGE (13), GIMP_PDB_LAYER (14), GIMP_PDB_CHANNEL (15), GIMP_PDB_DRAWABLE (16), GIMP_PDB_SELECTION (17), GIMP_PDB_BOUNDARY (18), GIMP_PDB_VECTORS (19), GIMP_PDB_PARASITE (20), GIMP_PDB_STATUS (21), GIMP_PDB_PATH (GIMP_PDB_VECTORS) }",
                                                     GIMP_TYPE_PDB_ARG_TYPE,
                                                     GIMP_PDB_INT32,
                                                     GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (&procedural_db_proc_val_proc,
                                  GIMP_PDB_STRING,
                                  gimp_param_spec_string ("val-name",
                                                          "val name",
                                                          "The name of the return value",
                                                          FALSE, FALSE,
                                                          NULL,
                                                          GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (&procedural_db_proc_val_proc,
                                  GIMP_PDB_STRING,
                                  gimp_param_spec_string ("val-desc",
                                                          "val desc",
                                                          "A description of the return value",
                                                          FALSE, FALSE,
                                                          NULL,
                                                          GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, &procedural_db_proc_val_proc);

  /*
   * procedural_db_get_data
   */
  procedural_db_init_proc (&procedural_db_get_data_proc, 1, 2);
  procedural_db_add_argument (&procedural_db_get_data_proc,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("identifier",
                                                      "identifier",
                                                      "The identifier associated with data",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (&procedural_db_get_data_proc,
                                  GIMP_PDB_INT32,
                                  g_param_spec_int ("bytes",
                                                    "bytes",
                                                    "The number of bytes in the data",
                                                    1, G_MAXINT32, 1,
                                                    GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (&procedural_db_get_data_proc,
                                  GIMP_PDB_INT8ARRAY,
                                  g_param_spec_pointer ("data",
                                                        "data",
                                                        "A byte array containing data",
                                                        GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, &procedural_db_get_data_proc);

  /*
   * procedural_db_get_data_size
   */
  procedural_db_init_proc (&procedural_db_get_data_size_proc, 1, 1);
  procedural_db_add_argument (&procedural_db_get_data_size_proc,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("identifier",
                                                      "identifier",
                                                      "The identifier associated with data",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (&procedural_db_get_data_size_proc,
                                  GIMP_PDB_INT32,
                                  g_param_spec_int ("bytes",
                                                    "bytes",
                                                    "The number of bytes in the data",
                                                    1, G_MAXINT32, 1,
                                                    GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, &procedural_db_get_data_size_proc);

  /*
   * procedural_db_set_data
   */
  procedural_db_init_proc (&procedural_db_set_data_proc, 3, 0);
  procedural_db_add_argument (&procedural_db_set_data_proc,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("identifier",
                                                      "identifier",
                                                      "The identifier associated with data",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_argument (&procedural_db_set_data_proc,
                              GIMP_PDB_INT32,
                              g_param_spec_int ("bytes",
                                                "bytes",
                                                "The number of bytes in the data",
                                                1, G_MAXINT32, 1,
                                                GIMP_PARAM_READWRITE));
  procedural_db_add_argument (&procedural_db_set_data_proc,
                              GIMP_PDB_INT8ARRAY,
                              g_param_spec_pointer ("data",
                                                    "data",
                                                    "A byte array containing data",
                                                    GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, &procedural_db_set_data_proc);

}

static Argument *
procedural_db_temp_name_invoker (ProcRecord   *proc_record,
                                 Gimp         *gimp,
                                 GimpContext  *context,
                                 GimpProgress *progress,
                                 Argument     *args)
{
  Argument *return_vals;
  gchar *temp_name = NULL;

  static gint proc_number = 0;

  temp_name = g_strdup_printf ("temp-procedure-number-%d", proc_number++);

  return_vals = procedural_db_return_values (proc_record, TRUE);
  return_vals[1].value.pdb_pointer = temp_name;

  return return_vals;
}

static ProcRecord procedural_db_temp_name_proc =
{
  "gimp-procedural-db-temp-name",
  "gimp-procedural-db-temp-name",
  "Generates a unique temporary PDB name.",
  "This procedure generates a temporary PDB entry name that is guaranteed to be unique. It is mainly used by the interactive popup dialogs to generate a PDB entry name.",
  "Andy Thomas",
  "Andy Thomas",
  "1998",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { procedural_db_temp_name_invoker } }
};

static Argument *
procedural_db_dump_invoker (ProcRecord   *proc_record,
                            Gimp         *gimp,
                            GimpContext  *context,
                            GimpProgress *progress,
                            Argument     *args)
{
  gboolean success = TRUE;
  gchar *filename;

  filename = (gchar *) args[0].value.pdb_pointer;
  if (filename == NULL)
    success = FALSE;

  if (success)
    {
      success = procedural_db_dump (gimp, filename);
    }

  return procedural_db_return_values (proc_record, success);
}

static ProcRecord procedural_db_dump_proc =
{
  "gimp-procedural-db-dump",
  "gimp-procedural-db-dump",
  "Dumps the current contents of the procedural database",
  "This procedure dumps the contents of the procedural database to the specified file. The file will contain all of the information provided for each registered procedure. This file is in a format appropriate for use with the supplied \"pdb_self_doc.el\" Elisp script, which generates a texinfo document.",
  "Spencer Kimball & Josh MacDonald",
  "Spencer Kimball & Josh MacDonald & Peter Mattis",
  "1995-1996",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { procedural_db_dump_invoker } }
};

static Argument *
procedural_db_query_invoker (ProcRecord   *proc_record,
                             Gimp         *gimp,
                             GimpContext  *context,
                             GimpProgress *progress,
                             Argument     *args)
{
  gboolean success = TRUE;
  Argument *return_vals;
  gchar *name;
  gchar *blurb;
  gchar *help;
  gchar *author;
  gchar *copyright;
  gchar *date;
  gchar *proc_type;
  gint32 num_matches = 0;
  gchar **procedure_names = NULL;

  name = (gchar *) args[0].value.pdb_pointer;
  if (name == NULL)
    success = FALSE;

  blurb = (gchar *) args[1].value.pdb_pointer;
  if (blurb == NULL)
    success = FALSE;

  help = (gchar *) args[2].value.pdb_pointer;
  if (help == NULL)
    success = FALSE;

  author = (gchar *) args[3].value.pdb_pointer;
  if (author == NULL)
    success = FALSE;

  copyright = (gchar *) args[4].value.pdb_pointer;
  if (copyright == NULL)
    success = FALSE;

  date = (gchar *) args[5].value.pdb_pointer;
  if (date == NULL)
    success = FALSE;

  proc_type = (gchar *) args[6].value.pdb_pointer;
  if (proc_type == NULL)
    success = FALSE;

  if (success)
    {
      success = procedural_db_query (gimp,
                                     name, blurb, help, author,
                                     copyright, date, proc_type,
                                     &num_matches, &procedure_names);
    }

  return_vals = procedural_db_return_values (proc_record, success);

  if (success)
    {
      return_vals[1].value.pdb_int = num_matches;
      return_vals[2].value.pdb_pointer = procedure_names;
    }

  return return_vals;
}

static ProcRecord procedural_db_query_proc =
{
  "gimp-procedural-db-query",
  "gimp-procedural-db-query",
  "Queries the procedural database for its contents using regular expression matching.",
  "This procedure queries the contents of the procedural database. It is supplied with seven arguments matching procedures on { name, blurb, help, author, copyright, date, procedure type}. This is accomplished using regular expression matching. For instance, to find all procedures with \"jpeg\" listed in the blurb, all seven arguments can be supplied as \".*\", except for the second, which can be supplied as \".*jpeg.*\". There are two return arguments for this procedure. The first is the number of procedures matching the query. The second is a concatenated list of procedure names corresponding to those matching the query. If no matching entries are found, then the returned string is NULL and the number of entries is 0.",
  "Spencer Kimball & Peter Mattis",
  "Spencer Kimball & Peter Mattis",
  "1995-1996",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { procedural_db_query_invoker } }
};

static Argument *
procedural_db_proc_info_invoker (ProcRecord   *proc_record,
                                 Gimp         *gimp,
                                 GimpContext  *context,
                                 GimpProgress *progress,
                                 Argument     *args)
{
  gboolean success = TRUE;
  Argument *return_vals;
  gchar *procedure;
  gchar *blurb = NULL;
  gchar *help = NULL;
  gchar *author = NULL;
  gchar *copyright = NULL;
  gchar *date = NULL;
  gint32 proc_type = 0;
  gint32 num_args = 0;
  gint32 num_values = 0;

  procedure = (gchar *) args[0].value.pdb_pointer;
  if (procedure == NULL || !g_utf8_validate (procedure, -1, NULL))
    success = FALSE;

  if (success)
    {
      GimpPDBProcType  ptype;
      gchar           *canonical;

      canonical = gimp_canonicalize_identifier (procedure);

      success = procedural_db_proc_info (gimp, canonical,
                                         &blurb, &help, &author,
                                         &copyright, &date, &ptype,
                                         &num_args, &num_values);
      proc_type = ptype;

      g_free (canonical);
    }

  return_vals = procedural_db_return_values (proc_record, success);

  if (success)
    {
      return_vals[1].value.pdb_pointer = blurb;
      return_vals[2].value.pdb_pointer = help;
      return_vals[3].value.pdb_pointer = author;
      return_vals[4].value.pdb_pointer = copyright;
      return_vals[5].value.pdb_pointer = date;
      return_vals[6].value.pdb_int = proc_type;
      return_vals[7].value.pdb_int = num_args;
      return_vals[8].value.pdb_int = num_values;
    }

  return return_vals;
}

static ProcRecord procedural_db_proc_info_proc =
{
  "gimp-procedural-db-proc-info",
  "gimp-procedural-db-proc-info",
  "Queries the procedural database for information on the specified procedure.",
  "This procedure returns information on the specified procedure. A short blurb, detailed help, author(s), copyright information, procedure type, number of input, and number of return values are returned. For specific information on each input argument and return value, use the 'gimp_procedural_db_proc_arg' and 'gimp_procedural_db_proc_val' procedures.",
  "Spencer Kimball & Peter Mattis",
  "Spencer Kimball & Peter Mattis",
  "1997",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { procedural_db_proc_info_invoker } }
};

static Argument *
procedural_db_proc_arg_invoker (ProcRecord   *proc_record,
                                Gimp         *gimp,
                                GimpContext  *context,
                                GimpProgress *progress,
                                Argument     *args)
{
  gboolean success = TRUE;
  Argument *return_vals;
  gchar *procedure;
  gint32 arg_num;
  gint32 arg_type = 0;
  gchar *arg_name = NULL;
  gchar *arg_desc = NULL;

  procedure = (gchar *) args[0].value.pdb_pointer;
  if (procedure == NULL || !g_utf8_validate (procedure, -1, NULL))
    success = FALSE;

  arg_num = args[1].value.pdb_int;

  if (success)
    {
      ProcRecord *proc;
      gchar      *canonical;

      canonical = gimp_canonicalize_identifier (procedure);

      proc = procedural_db_lookup (gimp, canonical);

      if (! proc)
        {
          const gchar *compat_name;

          compat_name = g_hash_table_lookup (gimp->procedural_compat_ht, canonical);

          if (compat_name)
            proc = procedural_db_lookup (gimp, compat_name);
        }

      g_free (canonical);

      if (proc && (arg_num >= 0 && arg_num < proc->num_args))
        {
          ProcArg *arg = &proc->args[arg_num];

          arg_type = arg->arg_type;
          arg_name = g_strdup (g_param_spec_get_name (arg->pspec));
          arg_desc = g_strdup (g_param_spec_get_blurb (arg->pspec));
        }
      else
        success = FALSE;
    }

  return_vals = procedural_db_return_values (proc_record, success);

  if (success)
    {
      return_vals[1].value.pdb_int = arg_type;
      return_vals[2].value.pdb_pointer = arg_name;
      return_vals[3].value.pdb_pointer = arg_desc;
    }

  return return_vals;
}

static ProcRecord procedural_db_proc_arg_proc =
{
  "gimp-procedural-db-proc-arg",
  "gimp-procedural-db-proc-arg",
  "Queries the procedural database for information on the specified procedure's argument.",
  "This procedure returns information on the specified procedure's argument. The argument type, name, and a description are retrieved.",
  "Spencer Kimball & Peter Mattis",
  "Spencer Kimball & Peter Mattis",
  "1997",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { procedural_db_proc_arg_invoker } }
};

static Argument *
procedural_db_proc_val_invoker (ProcRecord   *proc_record,
                                Gimp         *gimp,
                                GimpContext  *context,
                                GimpProgress *progress,
                                Argument     *args)
{
  gboolean success = TRUE;
  Argument *return_vals;
  gchar *procedure;
  gint32 val_num;
  gint32 val_type = 0;
  gchar *val_name = NULL;
  gchar *val_desc = NULL;

  procedure = (gchar *) args[0].value.pdb_pointer;
  if (procedure == NULL || !g_utf8_validate (procedure, -1, NULL))
    success = FALSE;

  val_num = args[1].value.pdb_int;

  if (success)
    {
      ProcRecord *proc;
      gchar      *canonical;

      canonical = gimp_canonicalize_identifier (procedure);

      proc = procedural_db_lookup (gimp, canonical);

      if (! proc)
        {
          const gchar *compat_name;

          compat_name = g_hash_table_lookup (gimp->procedural_compat_ht, canonical);

          if (compat_name)
            proc = procedural_db_lookup (gimp, compat_name);
        }

      g_free (canonical);

      if (proc && (val_num >= 0 && val_num < proc->num_values))
        {
          ProcArg *val = &proc->values[val_num];

          val_type = val->arg_type;
          val_name = g_strdup (g_param_spec_get_name (val->pspec));
          val_desc = g_strdup (g_param_spec_get_blurb (val->pspec));
        }
      else
        success = FALSE;
    }

  return_vals = procedural_db_return_values (proc_record, success);

  if (success)
    {
      return_vals[1].value.pdb_int = val_type;
      return_vals[2].value.pdb_pointer = val_name;
      return_vals[3].value.pdb_pointer = val_desc;
    }

  return return_vals;
}

static ProcRecord procedural_db_proc_val_proc =
{
  "gimp-procedural-db-proc-val",
  "gimp-procedural-db-proc-val",
  "Queries the procedural database for information on the specified procedure's return value.",
  "This procedure returns information on the specified procedure's return value. The return value type, name, and a description are retrieved.",
  "Spencer Kimball & Peter Mattis",
  "Spencer Kimball & Peter Mattis",
  "1997",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { procedural_db_proc_val_invoker } }
};

static Argument *
procedural_db_get_data_invoker (ProcRecord   *proc_record,
                                Gimp         *gimp,
                                GimpContext  *context,
                                GimpProgress *progress,
                                Argument     *args)
{
  gboolean success = TRUE;
  Argument *return_vals;
  gchar *identifier;
  gint32 bytes = 0;
  guint8 *data = NULL;

  identifier = (gchar *) args[0].value.pdb_pointer;
  if (identifier == NULL || !g_utf8_validate (identifier, -1, NULL))
    success = FALSE;

  if (success)
    {
      const guint8 *orig_data;
      gchar        *canonical;

      canonical = gimp_canonicalize_identifier (identifier);

      orig_data = plug_in_data_get (gimp, canonical, &bytes);

      g_free (canonical);

      if (orig_data)
        data = g_memdup (orig_data, bytes);
      else
        success = FALSE;
    }

  return_vals = procedural_db_return_values (proc_record, success);

  if (success)
    {
      return_vals[1].value.pdb_int = bytes;
      return_vals[2].value.pdb_pointer = data;
    }

  return return_vals;
}

static ProcRecord procedural_db_get_data_proc =
{
  "gimp-procedural-db-get-data",
  "gimp-procedural-db-get-data",
  "Returns data associated with the specified identifier.",
  "This procedure returns any data which may have been associated with the specified identifier. The data is a variable length array of bytes. If no data has been associated with the identifier, an error is returned.",
  "Spencer Kimball & Peter Mattis",
  "Spencer Kimball & Peter Mattis",
  "1997",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { procedural_db_get_data_invoker } }
};

static Argument *
procedural_db_get_data_size_invoker (ProcRecord   *proc_record,
                                     Gimp         *gimp,
                                     GimpContext  *context,
                                     GimpProgress *progress,
                                     Argument     *args)
{
  gboolean success = TRUE;
  Argument *return_vals;
  gchar *identifier;
  gint32 bytes = 0;

  identifier = (gchar *) args[0].value.pdb_pointer;
  if (identifier == NULL || !g_utf8_validate (identifier, -1, NULL))
    success = FALSE;

  if (success)
    {
      const guint8 *data;
      gchar        *canonical;

      canonical = gimp_canonicalize_identifier (identifier);

      data = plug_in_data_get (gimp, canonical, &bytes);

      g_free (canonical);

      if (! data)
        success = FALSE;

    }

  return_vals = procedural_db_return_values (proc_record, success);

  if (success)
    return_vals[1].value.pdb_int = bytes;

  return return_vals;
}

static ProcRecord procedural_db_get_data_size_proc =
{
  "gimp-procedural-db-get-data-size",
  "gimp-procedural-db-get-data-size",
  "Returns size of data associated with the specified identifier.",
  "This procedure returns the size of any data which may have been associated with the specified identifier. If no data has been associated with the identifier, an error is returned.",
  "Nick Lamb",
  "Nick Lamb",
  "1998",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { procedural_db_get_data_size_invoker } }
};

static Argument *
procedural_db_set_data_invoker (ProcRecord   *proc_record,
                                Gimp         *gimp,
                                GimpContext  *context,
                                GimpProgress *progress,
                                Argument     *args)
{
  gboolean success = TRUE;
  gchar *identifier;
  gint32 bytes;
  guint8 *data;

  identifier = (gchar *) args[0].value.pdb_pointer;
  if (identifier == NULL || !g_utf8_validate (identifier, -1, NULL))
    success = FALSE;

  bytes = args[1].value.pdb_int;
  if (bytes < 1)
    success = FALSE;

  data = (guint8 *) args[2].value.pdb_pointer;

  if (success)
    {
      gchar *canonical;

      canonical = gimp_canonicalize_identifier (identifier);

      plug_in_data_set (gimp, canonical, bytes, data);

      g_free (canonical);
    }

  return procedural_db_return_values (proc_record, success);
}

static ProcRecord procedural_db_set_data_proc =
{
  "gimp-procedural-db-set-data",
  "gimp-procedural-db-set-data",
  "Associates the specified identifier with the supplied data.",
  "This procedure associates the supplied data with the provided identifier. The data may be subsequently retrieved by a call to 'procedural-db-get-data'.",
  "Spencer Kimball & Peter Mattis",
  "Spencer Kimball & Peter Mattis",
  "1997",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { procedural_db_set_data_invoker } }
};
