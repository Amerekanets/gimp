/* The GIMP -- an image manipulation program
 * Copyright (C) 1995-2003 Spencer Kimball and Peter Mattis
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
 */

/* NOTE: This file is autogenerated by pdbgen.pl. */

#include "config.h"

#include <string.h>

#include <glib-object.h>

#include "libgimpcolor/gimpcolor.h"

#include "pdb-types.h"
#include "procedural_db.h"
#include "core/gimpparamspecs.h"

#include "core/gimp.h"
#include "core/gimpcontext.h"
#include "core/gimpdatafactory.h"
#include "core/gimplist.h"
#include "core/gimppalette.h"

static ProcRecord palette_new_proc;
static ProcRecord palette_duplicate_proc;
static ProcRecord palette_rename_proc;
static ProcRecord palette_delete_proc;
static ProcRecord palette_is_editable_proc;
static ProcRecord palette_get_info_proc;
static ProcRecord palette_get_columns_proc;
static ProcRecord palette_set_columns_proc;
static ProcRecord palette_add_entry_proc;
static ProcRecord palette_delete_entry_proc;
static ProcRecord palette_entry_get_color_proc;
static ProcRecord palette_entry_set_color_proc;
static ProcRecord palette_entry_get_name_proc;
static ProcRecord palette_entry_set_name_proc;

void
register_palette_procs (Gimp *gimp)
{
  ProcRecord *procedure;

  /*
   * palette_new
   */
  procedure = procedural_db_init_proc (&palette_new_proc, 1, 1);
  procedural_db_add_argument (procedure,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("name",
                                                      "name",
                                                      "The requested name of the new palette",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (procedure,
                                  GIMP_PDB_STRING,
                                  gimp_param_spec_string ("actual-name",
                                                          "actual name",
                                                          "The actual new palette name",
                                                          FALSE, FALSE,
                                                          NULL,
                                                          GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, procedure);

  /*
   * palette_duplicate
   */
  procedure = procedural_db_init_proc (&palette_duplicate_proc, 1, 1);
  procedural_db_add_argument (procedure,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("name",
                                                      "name",
                                                      "The palette name",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (procedure,
                                  GIMP_PDB_STRING,
                                  gimp_param_spec_string ("copy-name",
                                                          "copy name",
                                                          "The name of the palette's copy",
                                                          FALSE, FALSE,
                                                          NULL,
                                                          GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, procedure);

  /*
   * palette_rename
   */
  procedure = procedural_db_init_proc (&palette_rename_proc, 2, 1);
  procedural_db_add_argument (procedure,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("name",
                                                      "name",
                                                      "The palette name",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_argument (procedure,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("new-name",
                                                      "new name",
                                                      "The new name of the palette",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (procedure,
                                  GIMP_PDB_STRING,
                                  gimp_param_spec_string ("actual-name",
                                                          "actual name",
                                                          "The actual new name of the palette",
                                                          FALSE, FALSE,
                                                          NULL,
                                                          GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, procedure);

  /*
   * palette_delete
   */
  procedure = procedural_db_init_proc (&palette_delete_proc, 1, 0);
  procedural_db_add_argument (procedure,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("name",
                                                      "name",
                                                      "The palette name",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, procedure);

  /*
   * palette_is_editable
   */
  procedure = procedural_db_init_proc (&palette_is_editable_proc, 1, 1);
  procedural_db_add_argument (procedure,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("name",
                                                      "name",
                                                      "The palette name",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (procedure,
                                  GIMP_PDB_INT32,
                                  g_param_spec_boolean ("editable",
                                                        "editable",
                                                        "TRUE if the palette can be edited",
                                                        FALSE,
                                                        GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, procedure);

  /*
   * palette_get_info
   */
  procedure = procedural_db_init_proc (&palette_get_info_proc, 1, 1);
  procedural_db_add_argument (procedure,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("name",
                                                      "name",
                                                      "The palette name",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (procedure,
                                  GIMP_PDB_INT32,
                                  g_param_spec_int ("num-colors",
                                                    "num colors",
                                                    "The number of colors in the palette",
                                                    G_MININT32, G_MAXINT32, 0,
                                                    GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, procedure);

  /*
   * palette_get_columns
   */
  procedure = procedural_db_init_proc (&palette_get_columns_proc, 1, 1);
  procedural_db_add_argument (procedure,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("name",
                                                      "name",
                                                      "The palette name",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (procedure,
                                  GIMP_PDB_INT32,
                                  g_param_spec_int ("num-columns",
                                                    "num columns",
                                                    "The number of columns used to display this palette",
                                                    G_MININT32, G_MAXINT32, 0,
                                                    GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, procedure);

  /*
   * palette_set_columns
   */
  procedure = procedural_db_init_proc (&palette_set_columns_proc, 2, 0);
  procedural_db_add_argument (procedure,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("name",
                                                      "name",
                                                      "The palette name",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_argument (procedure,
                              GIMP_PDB_INT32,
                              g_param_spec_int ("columns",
                                                "columns",
                                                "The new number of columns",
                                                0, 64, 0,
                                                GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, procedure);

  /*
   * palette_add_entry
   */
  procedure = procedural_db_init_proc (&palette_add_entry_proc, 3, 1);
  procedural_db_add_argument (procedure,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("name",
                                                      "name",
                                                      "The palette name",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_argument (procedure,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("entry-name",
                                                      "entry name",
                                                      "The name of the entry",
                                                      FALSE, TRUE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_argument (procedure,
                              GIMP_PDB_COLOR,
                              gimp_param_spec_rgb ("color",
                                                   "color",
                                                   "The new entry's color color",
                                                   NULL,
                                                   GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (procedure,
                                  GIMP_PDB_INT32,
                                  g_param_spec_int ("entry-num",
                                                    "entry num",
                                                    "The index of the added entry",
                                                    G_MININT32, G_MAXINT32, 0,
                                                    GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, procedure);

  /*
   * palette_delete_entry
   */
  procedure = procedural_db_init_proc (&palette_delete_entry_proc, 2, 0);
  procedural_db_add_argument (procedure,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("name",
                                                      "name",
                                                      "The palette name",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_argument (procedure,
                              GIMP_PDB_INT32,
                              g_param_spec_int ("entry-num",
                                                "entry num",
                                                "The index of the added entry",
                                                G_MININT32, G_MAXINT32, 0,
                                                GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, procedure);

  /*
   * palette_entry_get_color
   */
  procedure = procedural_db_init_proc (&palette_entry_get_color_proc, 2, 1);
  procedural_db_add_argument (procedure,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("name",
                                                      "name",
                                                      "The palette name",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_argument (procedure,
                              GIMP_PDB_INT32,
                              g_param_spec_int ("entry-num",
                                                "entry num",
                                                "The entry to retrieve",
                                                G_MININT32, G_MAXINT32, 0,
                                                GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (procedure,
                                  GIMP_PDB_COLOR,
                                  gimp_param_spec_rgb ("color",
                                                       "color",
                                                       "The color requested",
                                                       NULL,
                                                       GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, procedure);

  /*
   * palette_entry_set_color
   */
  procedure = procedural_db_init_proc (&palette_entry_set_color_proc, 3, 0);
  procedural_db_add_argument (procedure,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("name",
                                                      "name",
                                                      "The palette name",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_argument (procedure,
                              GIMP_PDB_INT32,
                              g_param_spec_int ("entry-num",
                                                "entry num",
                                                "The entry to retrieve",
                                                G_MININT32, G_MAXINT32, 0,
                                                GIMP_PARAM_READWRITE));
  procedural_db_add_argument (procedure,
                              GIMP_PDB_COLOR,
                              gimp_param_spec_rgb ("color",
                                                   "color",
                                                   "The new color",
                                                   NULL,
                                                   GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, procedure);

  /*
   * palette_entry_get_name
   */
  procedure = procedural_db_init_proc (&palette_entry_get_name_proc, 2, 1);
  procedural_db_add_argument (procedure,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("name",
                                                      "name",
                                                      "The palette name",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_argument (procedure,
                              GIMP_PDB_INT32,
                              g_param_spec_int ("entry-num",
                                                "entry num",
                                                "The entry to retrieve",
                                                G_MININT32, G_MAXINT32, 0,
                                                GIMP_PARAM_READWRITE));
  procedural_db_add_return_value (procedure,
                                  GIMP_PDB_STRING,
                                  gimp_param_spec_string ("entry-name",
                                                          "entry name",
                                                          "The name requested",
                                                          FALSE, FALSE,
                                                          NULL,
                                                          GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, procedure);

  /*
   * palette_entry_set_name
   */
  procedure = procedural_db_init_proc (&palette_entry_set_name_proc, 3, 0);
  procedural_db_add_argument (procedure,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("name",
                                                      "name",
                                                      "The palette name",
                                                      FALSE, FALSE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_add_argument (procedure,
                              GIMP_PDB_INT32,
                              g_param_spec_int ("entry-num",
                                                "entry num",
                                                "The entry to retrieve",
                                                G_MININT32, G_MAXINT32, 0,
                                                GIMP_PARAM_READWRITE));
  procedural_db_add_argument (procedure,
                              GIMP_PDB_STRING,
                              gimp_param_spec_string ("entry-name",
                                                      "entry name",
                                                      "The new name",
                                                      FALSE, TRUE,
                                                      NULL,
                                                      GIMP_PARAM_READWRITE));
  procedural_db_register (gimp, procedure);

}

static Argument *
palette_new_invoker (ProcRecord   *proc_record,
                     Gimp         *gimp,
                     GimpContext  *context,
                     GimpProgress *progress,
                     Argument     *args)
{
  gboolean success = TRUE;
  Argument *return_vals;
  gchar *name;
  gchar *actual_name = NULL;

  name = (gchar *) g_value_get_string (&args[0].value);

  if (success)
    {
      if (strlen (name))
        {
          GimpData *data = gimp_data_factory_data_new (gimp->palette_factory, name);

          if (data)
            actual_name = g_strdup (gimp_object_get_name (GIMP_OBJECT (data)));
          else
            success = FALSE;
        }
      else
        success = FALSE;
    }

  return_vals = procedural_db_return_values (proc_record, success);

  if (success)
    g_value_take_string (&return_vals[1].value, actual_name);

  return return_vals;
}

static ProcRecord palette_new_proc =
{
  "gimp-palette-new",
  "gimp-palette-new",
  "Creates a new palette",
  "This procedure creates a new, uninitialized palette",
  "Michael Natterer <mitch@gimp.org>",
  "Michael Natterer",
  "2004",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { palette_new_invoker } }
};

static Argument *
palette_duplicate_invoker (ProcRecord   *proc_record,
                           Gimp         *gimp,
                           GimpContext  *context,
                           GimpProgress *progress,
                           Argument     *args)
{
  gboolean success = TRUE;
  Argument *return_vals;
  gchar *name;
  gchar *copy_name = NULL;

  name = (gchar *) g_value_get_string (&args[0].value);

  if (success)
    {
      GimpPalette *palette = (GimpPalette *)
        gimp_container_get_child_by_name (gimp->palette_factory->container, name);

      if (palette)
        {
          GimpPalette *palette_copy = (GimpPalette *)
            gimp_data_factory_data_duplicate (gimp->palette_factory,
                                              GIMP_DATA (palette));

          if (palette_copy)
            copy_name = g_strdup (gimp_object_get_name (GIMP_OBJECT (palette_copy)));
          else
            success = FALSE;
        }
      else
        success = FALSE;
    }

  return_vals = procedural_db_return_values (proc_record, success);

  if (success)
    g_value_take_string (&return_vals[1].value, copy_name);

  return return_vals;
}

static ProcRecord palette_duplicate_proc =
{
  "gimp-palette-duplicate",
  "gimp-palette-duplicate",
  "Duplicates a palette",
  "This procedure creates an identical palette by a different name",
  "Michael Natterer <mitch@gimp.org>",
  "Michael Natterer",
  "2004",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { palette_duplicate_invoker } }
};

static Argument *
palette_rename_invoker (ProcRecord   *proc_record,
                        Gimp         *gimp,
                        GimpContext  *context,
                        GimpProgress *progress,
                        Argument     *args)
{
  gboolean success = TRUE;
  Argument *return_vals;
  gchar *name;
  gchar *new_name;
  gchar *actual_name = NULL;

  name = (gchar *) g_value_get_string (&args[0].value);
  new_name = (gchar *) g_value_get_string (&args[1].value);

  if (success)
    {
      GimpPalette *palette = (GimpPalette *)
        gimp_container_get_child_by_name (gimp->palette_factory->container, name);

      if (palette && GIMP_DATA (palette)->writable)
        {
          gimp_object_set_name (GIMP_OBJECT (palette), new_name);
          actual_name = g_strdup (gimp_object_get_name (GIMP_OBJECT (palette)));
        }
      else
        success = FALSE;
    }

  return_vals = procedural_db_return_values (proc_record, success);

  if (success)
    g_value_take_string (&return_vals[1].value, actual_name);

  return return_vals;
}

static ProcRecord palette_rename_proc =
{
  "gimp-palette-rename",
  "gimp-palette-rename",
  "Rename a palette",
  "This procedure renames a palette",
  "Michael Natterer <mitch@gimp.org>",
  "Michael Natterer",
  "2004",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { palette_rename_invoker } }
};

static Argument *
palette_delete_invoker (ProcRecord   *proc_record,
                        Gimp         *gimp,
                        GimpContext  *context,
                        GimpProgress *progress,
                        Argument     *args)
{
  gboolean success = TRUE;
  gchar *name;

  name = (gchar *) g_value_get_string (&args[0].value);

  if (success)
    {
      GimpPalette *palette = (GimpPalette *)
        gimp_container_get_child_by_name (gimp->palette_factory->container, name);

      if (palette && GIMP_DATA (palette)->deletable)
        {
          GError *error = NULL;

          success = gimp_data_factory_data_delete (gimp->palette_factory,
                                                   GIMP_DATA (palette),
                                                   TRUE, &error);

          if (! success)
            {
              g_message (error->message);
              g_clear_error (&error);
            }
        }
      else
        success = FALSE;
    }

  return procedural_db_return_values (proc_record, success);
}

static ProcRecord palette_delete_proc =
{
  "gimp-palette-delete",
  "gimp-palette-delete",
  "Deletes a palette",
  "This procedure deletes a palette",
  "Michael Natterer <mitch@gimp.org>",
  "Michael Natterer",
  "2004",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { palette_delete_invoker } }
};

static Argument *
palette_is_editable_invoker (ProcRecord   *proc_record,
                             Gimp         *gimp,
                             GimpContext  *context,
                             GimpProgress *progress,
                             Argument     *args)
{
  gboolean success = TRUE;
  Argument *return_vals;
  gchar *name;
  gboolean editable = FALSE;

  name = (gchar *) g_value_get_string (&args[0].value);

  if (success)
    {
      GimpPalette *palette = (GimpPalette *)
        gimp_container_get_child_by_name (gimp->palette_factory->container, name);

      if (palette)
        editable = GIMP_DATA (palette)->writable;
      else
        success = FALSE;
    }

  return_vals = procedural_db_return_values (proc_record, success);

  if (success)
    g_value_set_boolean (&return_vals[1].value, editable);

  return return_vals;
}

static ProcRecord palette_is_editable_proc =
{
  "gimp-palette-is-editable",
  "gimp-palette-is-editable",
  "Tests if palette can be edited",
  "Returns TRUE if you have permission to change the palette",
  "Bill Skaggs <weskaggs@primate.ucdavis.edu>",
  "Bill Skaggs",
  "2004",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { palette_is_editable_invoker } }
};

static Argument *
palette_get_info_invoker (ProcRecord   *proc_record,
                          Gimp         *gimp,
                          GimpContext  *context,
                          GimpProgress *progress,
                          Argument     *args)
{
  gboolean success = TRUE;
  Argument *return_vals;
  gchar *name;
  gint32 num_colors = 0;

  name = (gchar *) g_value_get_string (&args[0].value);

  if (success)
    {
      GimpPalette *palette = (GimpPalette *)
        gimp_container_get_child_by_name (gimp->palette_factory->container, name);

      if (palette)
        num_colors = palette->n_colors;
      else
        success = FALSE;
    }

  return_vals = procedural_db_return_values (proc_record, success);

  if (success)
    g_value_set_int (&return_vals[1].value, num_colors);

  return return_vals;
}

static ProcRecord palette_get_info_proc =
{
  "gimp-palette-get-info",
  "gimp-palette-get-info",
  "Retrieve information about the specified palette.",
  "This procedure retrieves information about the specified palette. This includes the name, and the number of colors.",
  "Michael Natterer <mitch@gimp.org>",
  "Michael Natterer",
  "2004",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { palette_get_info_invoker } }
};

static Argument *
palette_get_columns_invoker (ProcRecord   *proc_record,
                             Gimp         *gimp,
                             GimpContext  *context,
                             GimpProgress *progress,
                             Argument     *args)
{
  gboolean success = TRUE;
  Argument *return_vals;
  gchar *name;
  gint32 num_columns = 0;

  name = (gchar *) g_value_get_string (&args[0].value);

  if (success)
    {
      GimpPalette *palette = (GimpPalette *)
        gimp_container_get_child_by_name (gimp->palette_factory->container, name);

      if (palette)
        num_columns = palette->n_columns;
      else
        success = FALSE;
    }

  return_vals = procedural_db_return_values (proc_record, success);

  if (success)
    g_value_set_int (&return_vals[1].value, num_columns);

  return return_vals;
}

static ProcRecord palette_get_columns_proc =
{
  "gimp-palette-get-columns",
  "gimp-palette-get-columns",
  "Retrieves the number of columns to use to display this palette",
  "This procedures retrieves the prefered number of columns to use when the palette is being displayed.",
  "Sven Neumann <sven@gimp.org>",
  "Sven Neumann",
  "2005",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { palette_get_columns_invoker } }
};

static Argument *
palette_set_columns_invoker (ProcRecord   *proc_record,
                             Gimp         *gimp,
                             GimpContext  *context,
                             GimpProgress *progress,
                             Argument     *args)
{
  gboolean success = TRUE;
  gchar *name;
  gint32 columns;

  name = (gchar *) g_value_get_string (&args[0].value);
  columns = g_value_get_int (&args[1].value);

  if (success)
    {
      GimpPalette *palette = (GimpPalette *)
        gimp_container_get_child_by_name (gimp->palette_factory->container, name);

      if (palette && GIMP_DATA (palette)->writable)
        gimp_palette_set_columns (palette, columns);
      else
        success = FALSE;
    }

  return procedural_db_return_values (proc_record, success);
}

static ProcRecord palette_set_columns_proc =
{
  "gimp-palette-set-columns",
  "gimp-palette-set-columns",
  "Sets the number of columns to use when displaying the palette",
  "This procedures allows to control how many colors are shown per row when the palette is being displayed. This value can only be changed if the palette is writable. The maximum allowed value is 64.",
  "Sven Neumann <sven@gimp.org>",
  "Sven Neumann",
  "2005",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { palette_set_columns_invoker } }
};

static Argument *
palette_add_entry_invoker (ProcRecord   *proc_record,
                           Gimp         *gimp,
                           GimpContext  *context,
                           GimpProgress *progress,
                           Argument     *args)
{
  gboolean success = TRUE;
  Argument *return_vals;
  gchar *name;
  gchar *entry_name;
  GimpRGB color;
  gint32 entry_num = 0;

  name = (gchar *) g_value_get_string (&args[0].value);
  entry_name = (gchar *) g_value_get_string (&args[1].value);
  gimp_value_get_rgb (&args[2].value, &color);

  if (success)
    {
      GimpPalette *palette = (GimpPalette *)
        gimp_container_get_child_by_name (gimp->palette_factory->container, name);

      if (palette && GIMP_DATA (palette)->writable)
        {
          GimpPaletteEntry *entry =
            gimp_palette_add_entry (palette, -1, entry_name, &color);

          entry_num = entry->position;
        }
      else
        success = FALSE;
    }

  return_vals = procedural_db_return_values (proc_record, success);

  if (success)
    g_value_set_int (&return_vals[1].value, entry_num);

  return return_vals;
}

static ProcRecord palette_add_entry_proc =
{
  "gimp-palette-add-entry",
  "gimp-palette-add-entry",
  "Adds a palette entry to the specified palette.",
  "This procedure adds an entry to the specifed palette. It returns an error if the entry palette does not exist.",
  "Michael Natterer <mitch@gimp.org>",
  "Michael Natterer",
  "2004",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { palette_add_entry_invoker } }
};

static Argument *
palette_delete_entry_invoker (ProcRecord   *proc_record,
                              Gimp         *gimp,
                              GimpContext  *context,
                              GimpProgress *progress,
                              Argument     *args)
{
  gboolean success = TRUE;
  gchar *name;
  gint32 entry_num;

  name = (gchar *) g_value_get_string (&args[0].value);
  entry_num = g_value_get_int (&args[1].value);

  if (success)
    {
      GimpPalette *palette = (GimpPalette *)
        gimp_container_get_child_by_name (gimp->palette_factory->container, name);

      if (palette && GIMP_DATA (palette)->writable)
        {
          if (entry_num >= 0 && entry_num < palette->n_colors)
            {
              GimpPaletteEntry *entry = g_list_nth_data (palette->colors, entry_num);

              gimp_palette_delete_entry (palette, entry);
            }
          else
            success = FALSE;
        }
      else
        success = FALSE;
    }

  return procedural_db_return_values (proc_record, success);
}

static ProcRecord palette_delete_entry_proc =
{
  "gimp-palette-delete-entry",
  "gimp-palette-delete-entry",
  "Deletes a palette entry from the specified palette.",
  "This procedure deletes an entry from the specifed palette. It returns an error if the entry palette does not exist.",
  "Michael Natterer <mitch@gimp.org>",
  "Michael Natterer",
  "2004",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { palette_delete_entry_invoker } }
};

static Argument *
palette_entry_get_color_invoker (ProcRecord   *proc_record,
                                 Gimp         *gimp,
                                 GimpContext  *context,
                                 GimpProgress *progress,
                                 Argument     *args)
{
  gboolean success = TRUE;
  Argument *return_vals;
  gchar *name;
  gint32 entry_num;
  GimpRGB color = { 0.0, 0.0, 0.0, 1.0 };

  name = (gchar *) g_value_get_string (&args[0].value);
  entry_num = g_value_get_int (&args[1].value);

  if (success)
    {
      GimpPalette *palette = (GimpPalette *)
        gimp_container_get_child_by_name (gimp->palette_factory->container, name);

      if (palette)
        {
          if (entry_num >= 0 && entry_num < palette->n_colors)
            {
              GimpPaletteEntry *entry = g_list_nth_data (palette->colors, entry_num);

              color = entry->color;
            }
          else
            success = FALSE;
        }
      else
        success = FALSE;
    }

  return_vals = procedural_db_return_values (proc_record, success);

  if (success)
    gimp_value_set_rgb (&return_vals[1].value, &color);

  return return_vals;
}

static ProcRecord palette_entry_get_color_proc =
{
  "gimp-palette-entry-get-color",
  "gimp-palette-entry-get-color",
  "Gets the specified palette entry from the specified palette.",
  "This procedure retrieves the color of the zero-based entry specifed for the specified palette. It returns an error if the entry does not exist.",
  "Michael Natterer <mitch@gimp.org>",
  "Michael Natterer",
  "2004",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { palette_entry_get_color_invoker } }
};

static Argument *
palette_entry_set_color_invoker (ProcRecord   *proc_record,
                                 Gimp         *gimp,
                                 GimpContext  *context,
                                 GimpProgress *progress,
                                 Argument     *args)
{
  gboolean success = TRUE;
  gchar *name;
  gint32 entry_num;
  GimpRGB color;

  name = (gchar *) g_value_get_string (&args[0].value);
  entry_num = g_value_get_int (&args[1].value);
  gimp_value_get_rgb (&args[2].value, &color);

  if (success)
    {
      GimpPalette *palette = (GimpPalette *)
        gimp_container_get_child_by_name (gimp->palette_factory->container, name);

      if (palette && GIMP_DATA (palette)->writable)
        {
          if (entry_num >= 0 && entry_num < palette->n_colors)
            {
              GimpPaletteEntry *entry = g_list_nth_data (palette->colors, entry_num);

              entry->color = color;

              gimp_data_dirty (GIMP_DATA (palette));
            }
          else
            success = FALSE;
        }
      else
        success = FALSE;
    }

  return procedural_db_return_values (proc_record, success);
}

static ProcRecord palette_entry_set_color_proc =
{
  "gimp-palette-entry-set-color",
  "gimp-palette-entry-set-color",
  "Sets the specified palette entry in the specified palette.",
  "This procedure sets the color of the zero-based entry specifed for the specified palette. It returns an error if the entry does not exist.",
  "Michael Natterer <mitch@gimp.org>",
  "Michael Natterer",
  "2004",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { palette_entry_set_color_invoker } }
};

static Argument *
palette_entry_get_name_invoker (ProcRecord   *proc_record,
                                Gimp         *gimp,
                                GimpContext  *context,
                                GimpProgress *progress,
                                Argument     *args)
{
  gboolean success = TRUE;
  Argument *return_vals;
  gchar *name;
  gint32 entry_num;
  gchar *entry_name = NULL;

  name = (gchar *) g_value_get_string (&args[0].value);
  entry_num = g_value_get_int (&args[1].value);

  if (success)
    {
      GimpPalette *palette = (GimpPalette *)
        gimp_container_get_child_by_name (gimp->palette_factory->container, name);

      if (palette)
        {
          if (entry_num >= 0 && entry_num < palette->n_colors)
            {
              GimpPaletteEntry *entry = g_list_nth_data (palette->colors, entry_num);

              entry_name = g_strdup (entry->name);
            }
          else
            success = FALSE;
        }
      else
        success = FALSE;
    }

  return_vals = procedural_db_return_values (proc_record, success);

  if (success)
    g_value_take_string (&return_vals[1].value, entry_name);

  return return_vals;
}

static ProcRecord palette_entry_get_name_proc =
{
  "gimp-palette-entry-get-name",
  "gimp-palette-entry-get-name",
  "Gets the specified palette entry from the specified palette.",
  "This procedure retrieves the name of the zero-based entry specifed for the specified palette. It returns an error if the entry does not exist.",
  "Michael Natterer <mitch@gimp.org>",
  "Michael Natterer",
  "2004",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { palette_entry_get_name_invoker } }
};

static Argument *
palette_entry_set_name_invoker (ProcRecord   *proc_record,
                                Gimp         *gimp,
                                GimpContext  *context,
                                GimpProgress *progress,
                                Argument     *args)
{
  gboolean success = TRUE;
  gchar *name;
  gint32 entry_num;
  gchar *entry_name;

  name = (gchar *) g_value_get_string (&args[0].value);
  entry_num = g_value_get_int (&args[1].value);
  entry_name = (gchar *) g_value_get_string (&args[2].value);

  if (success)
    {
      GimpPalette *palette = (GimpPalette *)
        gimp_container_get_child_by_name (gimp->palette_factory->container, name);

      if (palette && GIMP_DATA (palette)->writable)
        {
          if (entry_num >= 0 && entry_num < palette->n_colors)
            {
              GimpPaletteEntry *entry = g_list_nth_data (palette->colors, entry_num);

              g_free (entry->name);
              entry->name = g_strdup (entry_name);

              gimp_data_dirty (GIMP_DATA (palette));
            }
          else
            success = FALSE;
        }
      else
        success = FALSE;
    }

  return procedural_db_return_values (proc_record, success);
}

static ProcRecord palette_entry_set_name_proc =
{
  "gimp-palette-entry-set-name",
  "gimp-palette-entry-set-name",
  "Sets the specified palette entry in the specified palette.",
  "This procedure sets the name of the zero-based entry specifed for the specified palette. It returns an error if the entry does not exist.",
  "Michael Natterer <mitch@gimp.org>",
  "Michael Natterer",
  "2004",
  NULL,
  GIMP_INTERNAL,
  0, NULL, 0, NULL,
  { { palette_entry_set_name_invoker } }
};
